classes: {

    output: {
        style: {
            stroke: blue
        }
        label.near: bottom-center
    }
    module: {
        style: {
            border-radius: 999
        }
    }
    if-else: {
        shape: diamond
        style: {
            fill: GhostWhite
        }
    }

    met_requirement: {
        style: {
            fill: gold
            font-size: 12
        }
        label.near: bottom-center
    }

    gpu_module: {
        style: {
            fill: LightGreen
            border-radius: 999
        }
    }

}

input_frame_sequence{
    label: "ðŸ–¼ï¸ Input frame sequence"
    style.multiple: true
    near: center-left
}

human_detection{
    label: "ðŸ§ Human detection"
    class: gpu_module
}

human_bounding_box{
    label: "Human bounding box"
    icon: https://cdn-icons-png.flaticon.com/128/6302/6302663.png
    class: output
    style.multiple:true
}

human_count{
    label: "Human count"
    class: module
}


blood_detection{
    label: "ðŸ©¸ðŸ”¥ Blood and Fire detection"
    class: gpu_module
    note: |md PhÃ¡t hiá»‡n cÃ³ sá»± xuáº¥t hiá»‡n cá»§a mÃ¡u, lá»­a trÃªn áº£nh, khÃ´ng cáº§n phÃ¡t hiá»‡n vá»‹ trÃ­ cá»¥ thá»ƒ|
}



uniform_classification{
    label: "Uniform classification"
    class: gpu_module
}

bounding_box_with_type{
    label: "Human bounding box with uniform type"
    icon: https://cdn-icons-png.flaticon.com/128/6302/6302663.png
    class: output
    style.multiple: true
}

afk_detection{
    label: "AFK detection"
    class: module
}



met_requirement{
    label: "Met requirement"
    
    anomaly_afk{
        label: "Anomaly AFK"
        icon: https://cdn-icons-png.flaticon.com/128/3094/3094837.png
        class: met_requirement
    }

    detect_blood_anomaly{
        label: "ðŸ©¸ðŸ”¥ Detect blood and fire anomaly"
        icon: https://cdn-icons-png.flaticon.com/128/967/967119.png
        class: met_requirement
    }

    detect_anomaly_group{
        label: "Detect anomaly group"
        icon: https://cdn-icons-png.flaticon.com/128/3588/3588885.png
        class: met_requirement
    }
    
    violent_behavior: {
        label: "Violent Behavior"
        icon: https://cdn-icons-png.flaticon.com/128/2983/2983413.png
        note: |md
            ### HÃ nh Ä‘á»™ng báº¡o lá»±c
            - ÄÃ¡nh nhau, váº­t nhau
            - Khá»‘ng cháº¿, táº¥n cÃ´ng cÃ¡n bá»™ quáº£n giÃ¡o
            - Mang vÅ© khÃ­ (hung khÃ­) tá»›i trÆ°á»›c cá»•ng cÆ¡ quan
            - CÃ¡c hÃ nh Ä‘á»™ng báº¡o lá»±c nÃ³i chung
        |
        class: met_requirement
    }

    self_harm_and_injury: {
        label: "Self-Harm and Injury"
        icon: https://cdn-icons-png.flaticon.com/128/2983/2983413.png
        class: met_requirement
        note: |md
            ### Tá»± tá»­, tá»± thÆ°Æ¡ng
            - Äáº­p Ä‘áº§u vÃ o tÆ°á»ng
            - Treo cá»•
            - Cáº¯t cá»•, cá»• tay, cá»• chÃ¢n
            - HÃ nh Ä‘á»™ng trÃ¨o lÃªn cá»­a hoáº·c cÃ¡c vá»‹ trÃ­ cao nguy hiá»ƒm
            - PhÃ¡t hiá»‡n hÃ nh Ä‘á»™ng ngÃ£, Ä‘á»™t quá»µ.
        |
    }

    anomalous_behavior: {
        label: "Anomalous behavior"
        icon: https://cdn-icons-png.flaticon.com/128/2983/2983413.png
        class: met_requirement
        note: |md
            ### HÃ nh Ä‘á»™ng báº¥t thÆ°á»ng
            - XÃ© quáº§n Ã¡o, chÄƒn mÃ n
            - RÃºt chá»‰, se dÃ¢y dÃ i
            - MÃ i cÃ¡c váº­t sáº¯c nhá»n
            - HÃºt thuá»‘c
        |
    }
    escape_shackles: {
        label: "ThoÃ¡t khá»i cÃ¹m báº¥t thÆ°á»ng"
        icon: https://cdn-icons-png.flaticon.com/128/4458/4458758.png
        class: met_requirement
    }

    civilian_clothing: {
        label: ""
        icon: https://cdn-icons-png.flaticon.com/128/2331/2331716.png
        class: met_requirement
        note: |md
            ### Máº·c dÃ¢n sá»± Ä‘i láº¡i trong:
             - HÃ nh lang
             - Khu giam
             - TrÆ°á»ng chÃ²i
             - Cá»•ng khu giam
        |
    }

    detect_weapons: {
        label: "Detect weapons"
        icon: https://cdn-icons-png.flaticon.com/128/855/855023.png
        class: met_requirement
    }
    # near: bottom-center
}


detect_escape_shackles:{
    label: "Detect escape shackles"
    class: module
}

weapons_detection: {
    label: "Weapons detection"
    class: gpu_module
}

civilian_clothing_and_region_lockdown: {
    label: "Máº·c dÃ¢n sá»± trong khu vá»±c cáº¥m"
    class: module
}

human_activity_recognition : @human-activity-recognition.human_activity_recognition
input_frame_sequence -> human_detection -> human_bounding_box
bounding_box_with_type -> human_count -> met_requirement.detect_anomaly_group
bounding_box_with_type -> human_activity_recognition.keypoint_detection

input_frame_sequence -> blood_detection -> met_requirement.detect_blood_anomaly
human_bounding_box -> uniform_classification
uniform_classification -> bounding_box_with_type: "PhÃ¢n loáº¡i bounding boxes dá»±a theo thÃ´ng tin vá»‹ trÃ­ camera vÃ  uniform\nMá»¥c tiÃªu phÃ¢n loáº¡i vÃ  má»™t sá»‘ bÃ i toÃ¡n chá»‰ cáº§n check cho cÃ¡c há»c viÃªn (khÃ´ng check cho cÃ¡n bá»™)"

human_activity_recognition.keypoint_detection -> afk_detection -> met_requirement.anomaly_afk
human_activity_recognition.final_recognition -> met_requirement.violent_behavior
human_activity_recognition.final_recognition -> met_requirement.self_harm_and_injury
human_activity_recognition.final_recognition -> met_requirement.anomalous_behavior

bounding_box_with_type -> detect_escape_shackles -> met_requirement.escape_shackles
bounding_box_with_type -> weapons_detection -> met_requirement.detect_weapons
bounding_box_with_type -> civilian_clothing_and_region_lockdown -> met_requirement.civilian_clothing


legend{
    label: "ChÃº thÃ­ch"
    gpu_module: "GPU Module"
    module: "CPU Module"
    met_requirement: "Met requirement"
    near: bottom-right


    gpu_module.class: gpu_module
    module.class: module
    met_requirement.class: met_requirement
}


vlm_double_check: {
    label: "Sá»­ dá»¥ng VLM Ä‘á»ƒ double check ná»™i dung thÃ´ng bÃ¡o"
    # class: gpu_module
    
    vlm:{
        label: "VLM model"
        icon: https://github.com/NVlabs/VILA/raw/main/demo_images/vila-logo.jpg
        class: gpu_module
    }
    
    video_summary:{
        label: "Video summary"
        class: output
        icon: https://cdn-icons-png.flaticon.com/128/7311/7311390.png
    }

    validate_summary:{
        label: "Validate summary"
        class: module
    }

    vlm -> video_summary: "TÃ³m táº¯t ~3 giÃ¢y cá»§a video (3-5 frames)"
    video_summary -> validate_summary: "Xá»­ lÃ½ string Ä‘á»ƒ double check"
}

notification: {
    label: "Gá»­i thÃ´ng bÃ¡o"
    class: module
    style:{
        fill: orange
    }
}

met_requirement -> vlm_double_check.vlm
vlm_double_check.validate_summary -> notification